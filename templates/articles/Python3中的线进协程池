<!DOCTYPE html>
<html>
    <head>
        <title>Python3ä¸­çš„çº¿è¿›åç¨‹æ± </title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="created" content="2017-08-30T08:46:45+0800"/>
        <meta name="modified" content="2017-09-02T19:19:30+0800"/>
        <meta name="tags" content="Python, æŠ€æœ¯"/>
        <meta name="last device" content="Cpythonçš„MacBook Pro"/>
    </head>
    <body>
        <div class="note-wrapper">
            <h1>Python3ä¸­çš„çº¿è¿›åç¨‹æ± </h1>
<p><span class='hashtag'>#æŠ€æœ¯</span></p>
<p><span class='hashtag'>#Python</span></p>
<br>
<p><desc></p>
<blockquote>
<p>åœ¨ä¹‹å‰çš„åº”ç”¨å¼€å‘çš„åœºæ™¯ä¸­ï¼Œä¸ºäº†å¢åŠ ç¨‹åºçš„è¿è¡Œæ•ˆç‡æˆ‘ä¼šç”¨åˆ°å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹(æ”¾å± ä»æ¥æ²¡ç”¨åˆ°è¿‡è¿™ä¸ª)ã€‚æ€è·¯æœ‰ä¸¤ç§</p>
<br>
</blockquote>
<p>åœ¨ç»™äº†ä¸€ä¸ªtaskåˆ—è¡¨çš„å‰æä¸‹</p>
<ol start="1"><li>ç»™å…¶ä¸­çš„æ¯ä¸ªtaskéƒ½å¼€ä¸ªçº¿ç¨‹è·‘taskã€‚
</li><li>æŒ‡å®šçº¿ç¨‹æ•°æ¯”å¦‚40ç„¶åå°±å¼€40ä¸ªçº¿ç¨‹ã€‚ æŠŠæ‰€æœ‰çš„ä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªQueueé‡Œé¢å»ï¼Œç„¶åå†ç”¨queue.qsize(), queue.get()æ¥åˆ¤æ–­è·å– å¤–å±‚è¿˜è¦åŠ å¤šä¸ªtry catchæ¥åº”å¯¹å¤šçº¿ç¨‹çš„å˜åŒ–
</li></ol></desc>

ä»¥ä¸Šä¸¤ç§æƒ…å†µ ç¬¬ä¸€ç§å†™èµ·æ¥æ¯”è¾ƒç®€å• ä½†æ˜¯æœ‰æˆåƒä¸Šä¸‡ä¸ªä»»åŠ¡çš„æ—¶å€™å°±æ²¡åŠæ³•æ§åˆ¶çº¿ç¨‹çš„æ•°é‡ ä¹Ÿå°±æ˜¯ä¸é€‚ç”¨äºé«˜å¹¶å‘ã€‚ ç¬¬äºŒç§å†™èµ·æ¥æ¯”è¾ƒéº»çƒ¦è€Œä¸”ä¼ å‚æ•°æ›´éº»çƒ¦æˆ‘çš„å¤©ã€‚ 
ä»Šå¤©çœ‹åˆ°äº†dos_attck.pyé‡Œé¢ç”¨äº†çº¿ç¨‹æ± å’Œè¿›ç¨‹æ±  æˆ‘å°±æ¥ç ”ç©¶äº†ä¸€ä¸‹ å‘ç°å§æ§½ï¼ è¿™ç©æ„å„¿å¯¹ä¸Šé¢ğŸ‘†ä¸¤ç§æƒ…å†µè¿›è¡Œäº†åˆå¹¶ å–å…¶ç²¾åå»å…¶ç³Ÿç²• å¯ä»¥è¯´çˆ½ï¼

ç¬¬ä¸€æ­¥ å®‰è£…threadpoolæ¨¡å—
<blockquote>
pip install threadpool

</blockquote>
ç¬¬äºŒæ­¥ å†™ä»£ç 
<pre><code class='code-multiline'>from threadpool import ThreadPool
from threadpool import makeRequests
pool = ThreadPool(poolsize)  # æŒ‡å®špoolçš„å¤§å° ä¹Ÿå°±æ˜¯çº¿ç¨‹æ•°
requests = makeRequests(some_callable, list_of_args, callback) 
[pool.putRequest(req) for req in requests]  # ç”¨äº†è¡Œåˆ—å¼ç®€åŒ–
pool.wait()  # ç›¸å½“äº thread.join()</code></pre>
<p><br></p>
<p><mark>æ³¨æ„</mark>  makeRequests(some<i>callable, list</i>of_args, callback) </p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ ç›®æ ‡å‡½æ•°ã€‚ </p>
<p>ç¬¬äºŒä¸ªå¯¹è±¡æ˜¯ Nä¸ªå‚æ•° å¯ä»¥å°äºpoolsizeã€‚ å¦‚æœå¤§äºpoolsizeä»–å°±ä¼šè‡ªåŠ¨åˆ†é…ï¼Œ å¦‚æœç›®æ ‡å‚æ•°æœ‰å¤šä¸ªlist<i>of</i>args = [((1, 2, 3), {}), ((1, 2, 3), {})] è¿™æ ·çš„å½¢å¼</p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ callbackã€‚ æ¥å—ä¸¤ä¸ªå‚æ•° ä¸€ä¸ªå‚æ•°æ˜¯è¿”å›å€¼ ç¬¬äºŒä¸ªå‚æ•°æ˜¯<WorkRequest id=4505401664 args=['dd'] kwargs={} exception=False></p>
<br>
<br>
<p><b>æ€»ç»“</b></p>
<p>æ›´æ–¹ä¾¿ æ›´ç›´è§‚ ä»£ç æ›´å°‘</p>
<br>
<hr>
<br>
<h1>è¿›ç¨‹æ± (multiprocessing)</h1>
<p>ç‰©ä»¥ç±»èš å…¶å®éƒ½æ˜¯å·®ä¸å¤šçš„æ¦‚å¿µ</p>
<p>multiprocessingæ¨¡å—æ˜¯pythonè‡ªå¸¦ ä¸éœ€è¦å®‰è£…</p>
<pre><code class='code-multiline'>import multiprocessing
def func(msg):
    print(msg)
    return "func"

pool = multiprocessing.Pool(processes=3)
for i in range(4):
    msg = "hello %d" % i
    pool.apply_async(func, (msg, ))
pool.close()
pool.join()  # è°ƒç”¨joinä¹‹å‰ï¼Œå…ˆè°ƒç”¨closeå‡½æ•°ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚æ‰§è¡Œå®Œcloseåä¸ä¼šæœ‰æ–°çš„è¿›ç¨‹åŠ å…¥åˆ°pool, joinå‡½æ•°ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸ</code></pre>
<p><br></p>
<br>
<h1>åç¨‹æ± </h1>
<p>æŠŠè¿™ä¸‰ä¸ªç©æ„å„¿æ”¾ä¸€èµ·äº†ã€‚ ä¸Šç½‘æœå¥½åƒæ˜¯æ²¡æœ‰è¿™ä¸ªä»€ä¹ˆæ‰€è°“çš„åç¨‹æ± çš„ã€‚ åæ­£åŸç†éƒ½ä¸€æ ·é‚£æˆ‘å°±è‡ªå·±ç¼–ä¸€ä¸ªã€‚ ä¸»è¦æ˜¯çœ‹äº†Kç¥çš„grequestsæ¨¡å—å„¿ é‡Œé¢å°±æœ‰ç”¨åˆ°è¿™ä¸ªpoolçš„æ¦‚å¿µ æˆ‘å°±æŠŠä»–å•ç‹¬æå‡ºæ¥è®°å½•è®°å½•ã€‚ è‡³äºä¸æ‡‚ä»€ä¹ˆæ˜¯åç¨‹çš„å°æœ‹å‹å¯ä»¥å›å»è¡¥è¡¥ï¼Œä¿è¯ä½ ç”¨äº†ä»–ä»¥åä¸ä¼šæƒ³ç”¨å¤šçº¿ç¨‹äº†ã€‚</p>
<p><b>Pools are useful because you can specify size and can hence limit concurrency</b></p>
<br>
<blockquote>
<p>pip install grequests</p>
<br>
</blockquote>
<pre><code class='code-multiline'>import gevent
from gevent import monkey
from gevent.pool import Pool
monkey.patch_all(thread=False, select=False)
pool = gevent.Pool(size)

def func(param):
    print(param)
    return "func"

rs = [pool.spawn(func, "hello") for _ in range(4)]
gevent.joinall(tasks)

</code></pre>
        </div>
        <script type="text/javascript">
            (function() {

    var doc_ols = document.getElementsByTagName("ol");

    for ( i=0; i<doc_ols.length; i++) {

        var ol_start = doc_ols[i].getAttribute("start") - 1;
        doc_ols[i].setAttribute("style", "counter-reset:ol " + ol_start + ";");

    }

})();
        </script>
        <style>
            html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font:inherit;font-size:100%;vertical-align:baseline}html{line-height:1}ol,ul{list-style:none}table{border-collapse:collapse;border-spacing:0}caption,th,td{text-align:left;font-weight:normal;vertical-align:middle}q,blockquote{quotes:none}q:before,q:after,blockquote:before,blockquote:after{content:"";content:none}a img{border:none}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}*{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}html{font-size:87.5%;line-height:1.57143em}html{font-size:14px;line-height:1.6em;-webkit-text-size-adjust:100%}body{background:#fcfcfc;color:#545454;text-rendering:optimizeLegibility;font-family:"AvenirNext-Regular"}a{color:#de4c4f;text-decoration:none}h1{font-family:"AvenirNext-Medium";color:#333;font-size:1.6em;line-height:1.3em;margin-bottom:.78571em}h2{font-family:"AvenirNext-Medium";color:#333;font-size:1.3em;line-height:1em;margin-bottom:.62857em}h3{font-family:"AvenirNext-Medium";color:#333;font-size:1.15em;line-height:1em;margin-bottom:.47143em}p{margin-bottom:1.57143em;hyphens:auto}hr{height:1px;border:0;background-color:#dedede;margin:-1px auto 1.57143em auto}ul,ol{margin-bottom:1.57143em}ul ul,ul ol,ol ul,ol ol{margin-bottom:0px}ol li:before{content:counter(ol) ".";counter-increment:ol;color:#e06e73;text-align:right;display:inline-block;min-width:1em;margin-right:0.5em}b,strong{font-family:"AvenirNext-Bold"}i,em{font-family:"AvenirNext-Italic"}code{font-family:"Menlo-Regular"}.text-overflow-ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.sf_code_syntax_string{color:#D33905}.sf_code_syntax_comment{color:#838383}.sf_code_syntax_documentation_comment{color:#128901}.sf_code_syntax_number{color:#0E73A2}.sf_code_syntax_project{color:#5B2599}.sf_code_syntax_keyword{color:#0E73A2}.sf_code_syntax_character{color:#1B00CE}.sf_code_syntax_preprocessor{color:#920448}.note-wrapper{max-width:46em;margin:0px auto;padding:1.57143em 3.14286em}.note-wrapper.spotlight-preview{overflow-x:hidden}u{text-decoration:none;background-image:linear-gradient(to bottom, rgba(0,0,0,0) 50%,#e06e73 50%);background-repeat:repeat-x;background-size:2px 2px;background-position:0 1.05em}s{color:#878787}p{margin-bottom:0.1em}hr{margin-bottom:0.7em;margin-top:0.7em}ul li{text-indent:-0.6em}ul li:before{content:"â€¢";color:#e06e73;display:inline-block;margin-right:0.3em}ul ul{margin-left:1.25714em}ol li{text-indent:-1.55em}ol ol{margin-left:1.25714em}blockquote{display:block;margin-left:-1em;padding-left:0.8em;border-left:0.2em solid #e06e73}.todo-list ul{margin-left:1.88571em}.todo-list li{text-indent:-1.75em}.todo-list li:before{content:"";display:static;margin-right:0px}.todo-checkbox{text-indent:-1.7em}.todo-checkbox svg{margin-right:0.3em;position:relative;top:0.2em}.todo-checkbox svg #check{display:none}.todo-checkbox.todo-checked #check{display:inline}.todo-checkbox.todo-checked .todo-text{text-decoration:line-through;color:#878787}.code-inline{display:inline-block;background:white;border:solid 1px #dedede;padding:0.0em 0.5em;font-size:0.9em}.code-multiline{display:block;background:white;border:solid 1px #dedede;padding:0.7em 1em;font-size:0.9em;overflow-x:auto}.hashtag{display:inline-block;color:white;background:#b8bfc2;padding:0.0em 0.5em;border-radius:1em;text-indent:0}.hashtag a{color:#fff}.address a{color:#545454;background-image:linear-gradient(to bottom, rgba(0,0,0,0) 50%,#0da35e 50%);background-repeat:repeat-x;background-size:2px 2px;background-position:0 1.05em}.address svg{position:relative;top:0.2em;display:inline-block;margin-right:0.2em}.color-preview{display:inline-block;width:1em;height:1em;border:solid 1px rgba(0,0,0,0.3);border-radius:50%;margin-right:0.1em;position:relative;top:0.2em;white-space:nowrap}.color-code{margin-right:0.2em;font-family:"Menlo-Regular";font-size:0.9em}.color-hash{opacity:0.4}.ordered-list-number{color:#e06e73;text-align:right;display:inline-block;min-width:1em}.arrow svg{position:relative;top:0.08em;display:inline-block;margin-right:0.15em;margin-left:0.15em}.arrow svg #rod{stroke:#545454}.arrow svg #point{fill:#545454}mark{color:inherit;display:inline-block;padding:0px 4px;background-color:#fcffc0}img{max-width:100%;height:auto}

        </style>
    </body>
</html>

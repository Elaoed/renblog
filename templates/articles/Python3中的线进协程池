{% extends 'layout.html' %}
<title>Python3ä¸­çš„çº¿è¿›åç¨‹æ± </title>

{% block link %}
<link rel="stylesheet" style="text/css" href={{ url_for("static", filename="bear.css") }}>
<link rel="stylesheet" style="text/css" href={{ url_for("static", filename="style.css") }}>
<script src={{ url_for("static", filename="jquery-3.2.1.min.js") }}></script>
<script src={{ url_for("static", filename="bear.js") }}></script>
{% endblock %}
    {% block header %}

<meta name="created" content="2017-08-30 08:46:45">
<meta name="tags" content="Python, æŠ€æœ¯">

{% endblock %}
{% block body %}
                  <div class="note-wrapper">
<h1>Python3ä¸­çš„çº¿è¿›åç¨‹æ± </h1>
<p><span class="hashtag">#æŠ€æœ¯</span></p>
<p><span class="hashtag">#Python</span></p>
<br/>
<div class="desc">
åœ¨ä¹‹å‰çš„åº”ç”¨å¼€å‘çš„åœºæ™¯ä¸­ï¼Œä¸ºäº†å¢åŠ ç¨‹åºçš„è¿è¡Œæ•ˆç‡æˆ‘ä¼šç”¨åˆ°å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹ã€‚æ€è·¯æœ‰ä¸¤ç§
</div>
åœ¨ç»™äº†ä¸€ä¸ªtaskåˆ—è¡¨çš„å‰æä¸‹
<ol start="1">
    <li>ç»™å…¶ä¸­çš„æ¯ä¸ªtaskéƒ½å¼€ä¸ªçº¿ç¨‹è·‘taskã€‚</li>
    <li>æŒ‡å®šçº¿ç¨‹æ•°æ¯”å¦‚40ç„¶åå°±å¼€40ä¸ªçº¿ç¨‹ã€‚ æŠŠæ‰€æœ‰çš„ä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªQueueé‡Œé¢å»ï¼Œç„¶åå†ç”¨queue.qsize(), queue.get()æ¥åˆ¤æ–­è·å–å¤–å±‚è¿˜è¦åŠ å¤šä¸ªtry catchæ¥åº”å¯¹å¤šçº¿ç¨‹çš„å˜åŒ–</li>
    </ol>
<br/>
<p>ä»¥ä¸Šä¸¤ç§æƒ…å†µ ç¬¬ä¸€ç§å†™èµ·æ¥æ¯”è¾ƒç®€å• ä½†æ˜¯æœ‰æˆåƒä¸Šä¸‡ä¸ªä»»åŠ¡çš„æ—¶å€™å°±æ²¡åŠæ³•æ§åˆ¶çº¿ç¨‹çš„æ•°é‡ ä¹Ÿå°±æ˜¯ä¸é€‚ç”¨äºé«˜å¹¶å‘ã€‚ ç¬¬äºŒç§å†™èµ·æ¥æ¯”è¾ƒéº»çƒ¦è€Œä¸”ä¼ å‚æ•°æ›´éº»çƒ¦æˆ‘çš„å¤©ã€‚ </p>
<p>ä»Šå¤©çœ‹åˆ°äº†dos_attck.pyé‡Œé¢ç”¨äº†çº¿ç¨‹æ± å’Œè¿›ç¨‹æ±  æˆ‘å°±æ¥ç ”ç©¶äº†ä¸€ä¸‹ å‘ç°å§æ§½ï¼ è¿™ç©æ„å„¿å¯¹ä¸Šé¢ğŸ‘†ä¸¤ç§æƒ…å†µè¿›è¡Œäº†åˆå¹¶ å–å…¶ç²¾åå»å…¶ç³Ÿç²• å¯ä»¥è¯´çˆ½ï¼</p>
<br/>
<p>ç¬¬ä¸€æ­¥ å®‰è£…threadpoolæ¨¡å—</p>
<blockquote>
<p>pip install threadpool</p>
</blockquote>
<p>ç¬¬äºŒæ­¥ å†™ä»£ç </p>
<pre><code class="code-multiline">from threadpool import ThreadPool
from threadpool import makeRequests
pool = ThreadPool(poolsize)  # æŒ‡å®špoolçš„å¤§å° ä¹Ÿå°±æ˜¯çº¿ç¨‹æ•°
requests = makeRequests(some_callable, list_of_args, callback)
[pool.putRequest(req) for req in requests]  # ç”¨äº†è¡Œåˆ—å¼ç®€åŒ–
pool.wait()  # ç›¸å½“äº thread.join()</code></pre>
<p><br/></p>
<p><mark>æ³¨æ„</mark>  makeRequests(some_callable, list_of_args, callback) </p>
<p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ ç›®æ ‡å‡½æ•°ã€‚ </p>
<p>ç¬¬äºŒä¸ªå¯¹è±¡æ˜¯ Nä¸ªå‚æ•° å¯ä»¥å°äºpoolsizeã€‚ å¦‚æœå¤§äºpoolsizeä»–å°±ä¼šè‡ªåŠ¨åˆ†é…ï¼Œ å¦‚æœç›®æ ‡å‚æ•°æœ‰å¤šä¸ªlist_of_args = [((1, 2, 3), {}), ((1, 2, 3), {})] è¿™æ ·çš„å½¢å¼</p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ callbackã€‚ æ¥å—ä¸¤ä¸ªå‚æ•° ä¸€ä¸ªå‚æ•°æ˜¯è¿”å›å€¼ ç¬¬äºŒä¸ªå‚æ•°æ˜¯<workrequest args="['dd']" exception="False" id="4505401664" kwargs="{}"></workrequest></p>
<br/>
<br/>
<p><b>æ€»ç»“</b></p>
<p>æ›´æ–¹ä¾¿ æ›´ç›´è§‚ ä»£ç æ›´å°‘</p>
<br/>
<hr/>
<br/>
<h1>è¿›ç¨‹æ± (multiprocessing)</h1>
<p>ç‰©ä»¥ç±»èš å…¶å®éƒ½æ˜¯å·®ä¸å¤šçš„æ¦‚å¿µ</p>
<p>multiprocessingæ¨¡å—æ˜¯pythonè‡ªå¸¦ ä¸éœ€è¦å®‰è£…</p>
<pre><code class="code-multiline">import multiprocessing
def func(msg):
    print(msg)
    return "func"

pool = multiprocessing.Pool(processes=3)
for i in range(4):
    msg = "hello %d" % i
    pool.apply_async(func, (msg, ))
pool.close()
pool.join()  # è°ƒç”¨joinä¹‹å‰ï¼Œå…ˆè°ƒç”¨closeå‡½æ•°ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚æ‰§è¡Œå®Œcloseåä¸ä¼šæœ‰æ–°çš„è¿›ç¨‹åŠ å…¥åˆ°pool, joinå‡½æ•°ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹ç»“æŸ</code></pre>
<p><br/></p>
<br/>
<h1>åç¨‹æ± </h1>
<p>æŠŠè¿™ä¸‰ä¸ªç©æ„å„¿æ”¾ä¸€èµ·äº†ã€‚ ä¸Šç½‘æœå¥½åƒæ˜¯æ²¡æœ‰è¿™ä¸ªä»€ä¹ˆæ‰€è°“çš„åç¨‹æ± çš„ã€‚ åæ­£åŸç†éƒ½ä¸€æ ·é‚£æˆ‘å°±è‡ªå·±ç¼–ä¸€ä¸ªã€‚ ä¸»è¦æ˜¯çœ‹äº†Kç¥çš„grequestsæ¨¡å—å„¿ é‡Œé¢å°±æœ‰ç”¨åˆ°è¿™ä¸ªpoolçš„æ¦‚å¿µ æˆ‘å°±æŠŠä»–å•ç‹¬æå‡ºæ¥è®°å½•è®°å½•ã€‚ è‡³äºä¸æ‡‚ä»€ä¹ˆæ˜¯åç¨‹çš„å°æœ‹å‹å¯ä»¥å›å»è¡¥è¡¥ï¼Œä¿è¯ä½ ç”¨äº†ä»–ä»¥åä¸ä¼šæƒ³ç”¨å¤šçº¿ç¨‹äº†ã€‚</p>
<p><b>Pools are useful because you can specify size and can hence limit concurrency</b></p>
<br/>
<blockquote>
<p>pip install grequests</p>
</blockquote>
<pre><code class="code-multiline">import gevent
from gevent import monkey
from gevent.pool import Pool
monkey.patch_all(thread=False, select=False)
pool = gevent.Pool(size)

def func(param):
    print(param)
    return "func"

rs = [pool.spawn(func, "hello") for _ in range(4)]
gevent.joinall(tasks)

</code></pre>
</div>
{% endblock %}
